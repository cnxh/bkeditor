/*! Bkeditor - v0.9.0 - 2013-07-29
* https://github.com/daixianfeng/bkeditor
* Copyright (c) 2013 daixianfeng;*/
(function(e){if(window.FileReader&&window.XMLHttpRequest){e.addUi({id:"ajaxuploaddialog",html:'<div class="bke-ajaxupload-progress"><div>文件上传中,请稍等...</div><span>10% ( 1.1MB / 2.0MB )</span><ol></ol></div>'}),e.addPlugin({id:"ajaxupload",title:"文件上传",ui:"ajaxuploaddialog",type:"dialog"}),/Chrome/i.test(navigator.userAgent)&&e.bind("ajaxupload-paste","paste",function(t){if(t){var n=t.event.originalEvent.clipboardData,i=n.items,r=i[0];if("file"==r.kind&&r.type.match(/^image\//i)){var o=r.getAsFile(),a=new FileReader;return a.onload=function(t){var n='<img src="'+t.target.result+'"/>';e.pasteHTML(n)},a.readAsDataURL(o),!1}}}),e.bind("ajaxupload-dragover","dragover",function(t){var n=e.curEditor.getSelectionText();if(!n){var i=e.plugin("dragimage");i&&i.mousedown||(t.event.stopPropagation(),t.event.preventDefault())}}),e.bind("ajaxupload-drop","drop",function(n){if(n.event.originalEvent.dataTransfer.files.length){var i=[],r=[],o=e.curEditor.config.cBase.ajaxupload,a=e.plugin("ajaxupload"),s={event:n.event,minsize:1048576,maxsize:10737418240,action:o.uploadUrl,inputName:"filedata",init:function(){a.click()},onprogress:function(e){var t=$("#ajaxuploaddialog").find(".bke-ajaxupload-progress span");t.text(e.totalPercent+"% ( "+e.completeCount+"/"+e.totalCount+" )")},callback:function(e,t){if("object"==typeof t)if(t.success)i.push({url:t.url,file:e});else{e.data=t,r.push(e);var n=t.msg||"未知错误";this.error(e,n)}},oncomplete:function(){var t=[];for(var n in i)i[n].file.type.match(/^image\//i)?t.push('<img src="'+i[n].url+'" style="max-width:600px;" />'):t.push('<a href="'+i[n].url+'" target="_blank">'+i[n].file.name+"</a>");e.curEditor.insert(t.join("")),r.length?setTimeout(function(){$("#ajaxuploaddialog").find(".bke-ajaxupload-progress div").html("")},500):setTimeout(function(){e.dialog.close()},1e3)},error:function(e,t){$("#ajaxuploaddialog").find(".bke-ajaxupload-progress ol").append("<li>"+e.name+" 上传失败，原因: "+t+"</li>")}};t.ondrop(s)}});var t={xhr:new XMLHttpRequest,Client:null,completeCount:0,totalCount:0,totalSize:0,completeSize:1,isUploading:!1,fileList:[],successFileList:[],failureFileList:[],init:function(e){if(!this.isUploading){var t=this;t.completeCount=1,t.fileList=e,t.successFileList=[],t.failureFileList=[],t.isUploading=!0,t.totalCount=e.length,t.start()}},ondrop:function(e){var t=this,n=e.event.originalEvent.dataTransfer,i=[],r=n.files;t.Client=e,e.event.stopPropagation(),e.event.preventDefault();for(var o=0,a=r.length;a>o;o++)r[o].size&&(i.push(r[o]),t.totalSize+=r[o].size);i.length&&(e.init(i),t.init(i))},start:function(){var e=this,t=e.fileList,n=t.shift();n?e.post(n):e.complete()},complete:function(){var e=this;e.Client.oncomplete(),e.isUploading=!1},callback:function(e,t){var n,i=this;i.completeCount+=1,i.completeSize+=e.size||e.fileSize;try{n=$.parseJSON(t)}catch(r){}i.Client.callback(e,n)},onprogress:function(e,t){var n=this;if(e&&e.loaded>=0){var i=t.size||t.fileSize,r=Math.round(100*e.loaded/i),o=Math.round(100*(e.loaded+n.completeSize)/n.totalSize),a={totalPercent:o,currentPercent:r,loaded:n.formatBytes(e.loaded),size:n.formatBytes(i),name:t.name||t.fileName,completeSize:n.formatBytes(e.loaded+n.completeSize),totalSize:n.formatBytes(n.totalSize),completeCount:n.completeCount,totalCount:n.totalCount};n.Client.onprogress(a)}},post:function(e){var t=this,n=t.xhr;n.onreadystatechange=function(){4===n.readyState&&(200==n.status?(t.successFileList.push(e),t.callback(e,n.responseText),t.start()):t.failureFileList.push(e))},n.upload?n.upload.onprogress=function(n){t.onprogress(n,e)}:t.onprogress(!1),n.open("POST",t.Client.action),n.setRequestHeader("Content-Type","application/octet-stream"),n.setRequestHeader("Content-Disposition",'attachment; name="'+t.Client.inputName+'"; filename="'+(e.name||e.fileName)+'"'),n.sendAsBinary?n.sendAsBinary(e.getAsBinary()):n.send(e)},formatBytes:function(e){var t=["Byte","KB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(2)+t[n]}}}})(jQuery.jQEditor),function(e,t){function n(){function n(e){var n=e.config,i=t("#"+e.Eid).find(".bke-toolbar");i.size()&&(n.toolbarTop=i.offset().top?i.offset().top:n.toolbarTop,i.parent().height(i.height()))}t.each(e.editorList,function(e,t){n(t)})}function i(e){var n=e.dom,i=0,r=n.createElement("DIV");r.style.clear="both",r.style.display="block",n.body.appendChild(r),i=Math.max(r.offsetTop+20,e.config.height),n.body.removeChild(r);var o=t("#"+e.Eid);o.find("iframe").is(":visible")&&(o.find("iframe:visible").height(i),o.find(".bke-iframeholder").height(i)),o.find(".bke-iframeholder textarea").height(i)}function r(n){var i=t(window).scrollTop(),r=n.config,a=t("#"+n.Eid),s=a.find(".bke-toolbar"),l=0;s.size()&&r.autoHeight&&(l=a.offset().top+a.height()-30,r.toolbarTop&&(r.toolbarTop>i||i>l)?(s.removeClass(r.fixedClassName),e.IE6&&(s[0].style.removeExpression("top"),s[0].style.position="static"),o=!1):(o||(s.width(s.width()).addClass(r.fixedClassName),e.IE6&&(s[0].style.setExpression("top",'eval(document.documentElement.scrollTop)+"px"'),s[0].style.position="absolute")),o=!0))}var o=!1;if(e.IE6&&"fixed"!==document.body.currentStyle.backgroundAttachment){var a=document.getElementsByTagName("html")[0];a.style.backgroundImage="url(about:blank)",a.style.backgroundAttachment="fixed"}e.addEvent({name:"autoHeight",type:["complete"],fn:function(){function n(r){return setTimeout(function(){t.each(e.editorList,function(e,t){t.config.autoHeight&&i(t)})},r),n}n(0)(300)(1e3)(2e3)(5e3)}}),e.addEvent({name:"autoHeight",type:["afterCommand","keyup"],fn:function(){e.curEditor.config.autoHeight&&i(e.curEditor)}}),t(window).scroll(function(){t.each(e.editorList,function(n,i){if(e.curEditor===i)r(i);else{var o=i.config,a=t("#"+i.Eid).find(".bke-toolbar");a.removeClass(o.fixedClassName)}})}),e.addEvent({name:"setToolbarTop",type:["complete","active"],fn:function(){setTimeout(function(){n()},0)}});var s=0;t(window).resize(function(){clearTimeout(s),s=setTimeout(function(){n()},200)})}(jQuery.jQEditor,jQuery),function(e,t){function n(t,n){var i={name:"表格",icon:"bke-InsertTable",submenu:[{name:"删除表格",icon:"bke-RemoveTable",cmd:"deletetable"},{name:"-"},{name:"左插入列",icon:"bke-ColumnInsertBefore",cmd:"insertcolbefore"},{name:"右插入列",icon:"bke-ColumnInsertAfter",cmd:"insertcolafter"},{name:"上插入行",icon:"bke-RowInsertBefore",cmd:"insertrowbefore"},{name:"下插入行",icon:"bke-RowInsertAfter",cmd:"insertrowafter"},{name:"-"},{},{},{name:"-"},{name:"合并单元格",icon:"bke-CellCombine",cmd:"combinecells"},{name:"向下合并",icon:"bke-RowMergeAfter",cmd:"combinerowafter"},{name:"向右合并",icon:"bke-ColumnMergeAfter",cmd:"combinecolafter"},{name:"-"},{name:"表格属性",icon:"bke-TableProps",cmd:"tableprops"}]};i.submenu[7]=n.find("caption").length?{name:"删除表格名称",cmd:"tabletitle"}:{name:"插入表格名称",cmd:"tabletitle"},i.submenu[8]=n.find("th").length?{name:"删除表格标题行",cmd:"tablehead"}:{name:"插入表格标题行",cmd:"tablehead"},t.push(i),t.push({name:"单元格对齐方式",icon:"bke-JustifyFull",submenu:[{name:"居左",cmd:"celljustify",param:"4"},{name:"居中",cmd:"celljustify",param:"5"},{name:"居右",cmd:"celljustify",param:"6"},{name:"-"},{name:"居左（靠上）",cmd:"celljustify",param:"1"},{name:"居中（靠上）",cmd:"celljustify",param:"2"},{name:"居右（靠上）",cmd:"celljustify",param:"3"},{name:"-"},{name:"居左（靠下）",cmd:"celljustify",param:"7"},{name:"居中（靠下）",cmd:"celljustify",param:"8"},{name:"居右（靠下）",cmd:"celljustify",param:"9"}]},{name:"表格对齐方式",submenu:[{name:"左浮动",cmd:"tablefloat",param:"1"},{name:"居中",cmd:"tablefloat",param:"2"},{name:"右浮动",cmd:"tablefloat",param:"3"}]});var r={name:"单元格背景色",submenu:e.utils.execPlugin("colormenu","getCellcolorPicker")};return t.push(r),t}e.addEvent({name:"contextmenu",type:["contextmenu"],area:"editArea",fn:function(i){var r=e.plugin("shortcutmenu");if(!r||r.contextmenu()){var o=[];o.push({name:"全选",cmd:"selectall",icon:"bke-SelectAll"},{name:"清空文档",cmd:"cleardoc",icon:"bke-ClearDoc"},{name:"separator"});var a=t(i.target).closest("table");a.length?o=n(o,a):o.push({name:"段落格式",icon:"bke-JustifyFull",submenu:[{name:"左对齐",cmd:"justifyleft",icon:"bke-JustifyLeft"},{name:"右对齐",cmd:"justifyright",icon:"bke-JustifyRight"},{name:"居中对齐",cmd:"justifycenter",icon:"bke-JustifyCenter"},{name:"两端对齐",cmd:"justifyfull",icon:"bke-JustifyFull"}]},{name:"插入表格",icon:"bke-InsertTable",submenu:e.utils.execPlugin("tablemenu","getTablePanel")}),o.push({name:"separator"},{name:"段前插入段落",cmd:"insertparagraphbefore",param:""},{name:"段后插入段落",cmd:"insertparagraphafter",param:""},{name:"复制(Ctrl + c)",icon:"bke-Copy",cmd:"copy"},{name:"粘帖(Ctrl + v)",icon:"bke-Paste",cmd:"paste"},{name:"插入代码",icon:"bke-Code",cmd:"highlightcode"}),e.Menu.contextmenu(o,i),t(i.target).hasClass("selectCellClass")}}})}(jQuery.jQEditor,jQuery),function(e,t){e.addEvent({name:"cursorelements",type:["mousedown","keyup"],area:"editArea",fn:function(n){var i=n.target;if(t(i).is("body")){var r=e.utils.getCurElement();r.pop(),i=r.pop()}var o={},a=e.$(i),s=a.closest("h1,h2,h3,h4,h5,h6,h7"),l=a.closest("a"),c=a.closest("img"),d=a.closest("pre"),u=a.closest("sub"),f=a.closest("sup.refer"),m=a.closest("sup"),h=a.closest("td,th"),p=h.closest("tr"),g=p.closest("table"),b=a.closest("ol"),v=a.closest("ul"),y=a.closest("embed");s.length&&(o.hn=s[0]),l.length&&(o.a=l[0]),c.length&&(o.img=c[0]),d.length&&(o.pre=d[0]),u.length&&(o.sub=u[0]),f.length&&(o.refer=f[0]),m.length&&(o.sup=m[0]),h.length&&(o.cell=h[0]),p.length&&(o.row=p[0]),g.length&&(o.table=g[0]),b.length&&(o.ol=b[0]),v.length&&(o.ul=v[0]),y.length&&(o.embed=y[0]),e.curEditor.cursorElements=o}})}(jQuery.jQEditor,jQuery),function(e,t){function n(n){var i="html",r="",o=n.closest("[cmd]").attr("cmd"),a="";t.trim(n.text())?(r=n.text(),a=n.text()):a=e.getLang("labelMap."+o.toLowerCase())||n.text(),n.children().size()&&(i="prepend"),n[i]("<a href=\"javascript: void('"+o+'\')" title="'+a+'">'+r+"</a>")}e.addEvent({name:"commandHidePanel",type:["beforeCommand"],fn:function(t){var n=t.commandName;e.toolbar.hidePanel(n),e.curEditor.baseHistory&&"revert"!==n&&"redo"!==n&&"codemirror"!==n&&"source"!==n&&e.curEditor.baseHistory.prepareHistory()}}),e.addEvent({name:"recordHistory",type:["afterCommand"],fn:function(t){e.curEditor.baseHistory&&"revert"!==t.commandName&&"redo"!==t.commandName&&e.curEditor.baseHistory.recordHistory()}}),e.addEvent({name:"toolbarinit",type:["complete"],fn:function(i){e.editorList[i.Eid].config;var r=t('[ref="'+i.Eid+'"] .bke-toolbar');r.find(".bke-icon, .bke-caret").each(function(){n(t(this))}),r.find("div[cmd],span[cmd]").each(function(){var e=t(this),n=e.attr("cmd");e.attr("id","icon-"+n)}),r.find(".bke-text").each(function(){var e=t(this);e.find(".bke-caret").size()?e.find(".bke-caret").prev().each(function(){n(t(this))}):n(e)})}})}(jQuery.jQEditor,jQuery),function(e,t){t(".bke-dialog").live("click",function(n){var i=t(n.target),r=i.attr("cmd"),o=i.attr("param"),a=i.closest(".bke-dialog").attr("id");return i.attr("cmd")?(e.command(a,r,o),!1):void 0})}(window.jQuery.jQEditor,window.jQuery),function(e,t){function n(){var n=e.$("img");n.each(function(){var e=t(this);e.attr("id","img-"+o),e.closest("div.img").attr("id","wrap-img-"+o),o+=1})}function i(t){var n=t.closest("div.img"),i=t.attr("id");n.length||(e.$("#wrap-"+i).hide(),e.curEditor.baseHistory.prepareHistory(),setTimeout(function(){var t=e.$("#"+i),n=e.$("#wrap-"+i);t.parent().is("a")?(t.parent().after(n),n.prepend(t.parent())):(t.after(n),n.prepend(t)),n.show(),e.curEditor.baseHistory.recordHistory(1),e.trigger("mouseup")},0))}e.addPlugin({id:"dragimage",mousedown:!1});var r,o=0;e.addEvent({name:"dragimage-mousedown",type:["mousedown"],area:"editArea",fn:function(t){"img"===t.target.nodeName.toLowerCase()?(r=t.target,e.plugin("dragimage").mousedown=!0,/MSIE [678]\.0/i.test(navigator.userAgent)&&e.$(r).unbind("dragend").bind("dragend",function(){i(e.$(this))})):r=null}}),e.bind("dragimage-mouseup","mouseup",function(){e.plugin("dragimage").mousedown=!1}),e.addEvent({name:"dragimage-dragend",type:["dragend"],area:"editArea",fn:function(){r&&i(e.$(r))}}),e.addEvent({name:"dragimage-complete",type:["complete"],fn:function(){n()}})}(jQuery.jQEditor,jQuery),function(e,t){function n(t,n,i){e.IE&&/paste/i.test(n)&&(t=t.find("body")),t.bind(n,function(t){return e.trigger(n,{targetElement:t.target,target:t.target,event:t,targetEditor:i})})}var i="click,mousedown,mouseup,mouseenter,mouseleave,scroll,keypress,keyup,keydown,paste,beforepaste,dragenter,dragover,drop,dragleave,dragend".split(",");e.listenEditarea=function(r){var o=t(r.dom);o.bind("contextmenu",function(t){return t.ctrlKey||t.shiftKey||t.altKey?!0:(e.trigger("contextmenu",{targetElement:t.target,target:t.target,clientX:t.clientX,clientY:t.clientY,targetEditor:r}),!1)});for(var a=0,s=i.length;s>a;a++){var l=t.trim(i[a]);n(o,l,r)}var c=e.IE?"beforepaste":"paste";o.find("body").bind(c,function(){e.utils.execPlugin("paste","paste")}),o.find("body").bind("beforecopy",function(){o.find("body").unbind(c),setTimeout(function(){o.find("body").bind(c,function(){e.utils.execPlugin("paste","paste")})},0),e.IE&&e.errorMessage("请使用 Ctrl+v 进行粘贴")}),o.bind("keydown",function(t){if(t.shiftKey&&13===t.which);else if(t.ctrlKey&&13===t.which);else if(t.ctrlKey&&67===t.which);else if(t.ctrlKey&&86===t.which);else if(t.ctrlKey&&88===t.which);else{if(t.ctrlKey&&66===t.which)return e.command("bold"),!1;if(t.ctrlKey&&73===t.which)return e.command("italic"),!1;if(t.ctrlKey&&85===t.which)return e.command("underline"),!1;if(t.ctrlKey&&90===t.which)return e.command("undo"),!1;if(t.ctrlKey&&89===t.which)return e.command("redo"),!1;if(t.ctrlKey&&65===t.which)return e.curEditor.selectAll(),!1;if(t.ctrlKey&&70===t.which)return e.command("search"),!1;if(t.ctrlKey&&72===t.which)return e.command("replace"),!1;if(t.ctrlKey&&83===t.which)return alert(11),!1;13===t.which?(e.curEditor.baseHistory.prepareHistory(),setTimeout(function(){e.curEditor.baseHistory.recordHistory()},0)):8===t.which||46===t.which}setTimeout(function(){var t=+new Date;t-r.baseHistory.getLastTime()>3e3&&(e.curEditor.baseHistory.prepareHistory(),e.curEditor.baseHistory.recordHistory())},0)}),o.bind("mouseenter",function(){e.curId!==r.Eid&&(e.curId=r.Eid,e.curEditor=r,e.trigger("active",{editor:r}))}).bind("mousedown",function(){o.bind("mousemove.drag",function(t){e.trigger("drag",{targetElement:t,targetEditor:r})})}).bind("mouseup",function(){o.unbind("mousemove.drag")})},e.addEvent({name:"editareaHidePanel",type:["mousedown","keydown"],area:"editArea",fn:function(){e.toolbar.hidePanel()}}),/AppleWebKit/i.test(navigator.userAgent)&&e.addEvent({name:"selectimg",type:["mousedown"],area:"editArea",fn:function(t){"img"===t.target.nodeName.toLowerCase()&&e.utils.selectNode(e.curEditor.win,t.target)}})}(window.jQuery.jQEditor,window.jQuery),function(e,t){function n(n,i){var r=e.pluginList.table,o=t(n).find("tr").length-1,a=t(n).find("tr:first").find("th,td").length-1,s=i.colStart,l=i.colEnd,c=i.rowStart,d=i.rowEnd;e:for(;;){var u={},f={},m={};if(s>0){for(var h=c;d>=h;h++)if(u=t(n).find("[col="+s+"][row="+h+"]"),m=r._rowInfo(u),0>m.isInRow){if(m.lastColspan>1&&m.isInRow+m.lastColspan>0){s-=1;continue e}}else if(f=r._colInfo(u),f.isInCol>=0){s-=1;continue e}}else s=0;if(c>0){for(var p=s;l>=p;p++)if(u=t(n).find("[row="+c+"][col="+p+"]"),f=r._colInfo(u),0>f.isIncol){if(f.lastRowspan>1&&f.isIncol+f.lastRowspan>0){c-=1;continue e}}else if(m=r._rowInfo(u),m.isInRow>=0){c-=1;continue e}}else c=0;if(a>l){for(var h=c;d>=h;h++)if(u=t(n).find("[col="+l+"][row="+h+"]"),m=r._rowInfo(u),0>m.isInRow&&m.lastColspan>1&&-1>m.isInRow){l+=1;continue e}}else l=a;if(o>d){for(var p=s;l>=p;p++)if(u=t(n).find("[row="+d+"][col="+p+"]"),f=r._colInfo(u),0>f.isInCol&&f.lastRowspan>1&&-1>f.isInCol){d+=1;continue e}}else d=o;break e}return{colStart:s,colEnd:l,rowStart:c,rowEnd:d}}function i(e){var n=e.target,i=t(n).closest("table"),o=t(n).closest("body"),a=e.offsetX,s=n.offsetWidth,l=e.offsetY,c=n.offsetHeight;if(i.unbind("mousedown.dragLine"),4>a)o.css("cursor","col-resize"),r(i,{leftTd:t(n).prev("td").not(":hidden")[0],rightTd:n},!1);else if(4>s-a)o.css("cursor","col-resize"),r(i,{leftTd:n,rightTd:t(n).next("td").not(":hidden")[0]},!1);else if(4>l){o.css("cursor","row-resize");var d=parseInt(t(n).attr("col")),u=t(n.parentNode).prev("tr").length?t(n.parentNode).prev("tr").find("td").eq(d).not(":hidden")[0]:void 0;r(i,{topTd:u,bottomTd:n},!0)}else if(4>c-l){o.css("cursor","row-resize");var f=t(n.parentNode).next("tr").length?t(n.parentNode).next("tr").find("td").eq(d).not(":hidden")[0]:void 0;r(i,{topTd:n,bottomTd:f},!0)}else o.css("cursor","default"),i.unbind("mousedown.dragLine")}function r(n,r,a){var s=t(n).closest("body");return void 0===r.topTd&&a===!0?0:void 0===r.leftTd&&a===!1?0:(t(n).bind("mousedown.dragLine",function(l){t(n).find("td").unbind("mousemove.cursorState");var c=l.clientX,d=l.clientY;t(n).parent().append("<div></div>");var u=t(n).parent().children(":last");u.css("position","absolute"),u.css("display","block"),u.css("width","1px"),u.css("height","1px"),u.css("z-index","11"),a===!0?u.width(t(n).find("tbody").width()):u.height(t(n).find("tbody").height());var f=t(n).offset().top,m=t(n).offset().left;a===!0?f+=t(r.topTd)[0].offsetTop+t(r.topTd)[0].offsetHeight:m+=t(r.leftTd)[0].offsetLeft+t(r.leftTd)[0].offsetWidth,u.css("top",f),u.css("left",m),u.css("background-color","green"),t(s).bind("mousemove.changeCell",function(n){e.utils.removeSelection(e.curEditor.win);var i=n.clientX,o=n.clientY;a?o-d+t(r.topTd)[0].offsetHeight>45&&u.css("top",f+o-d):i-c+t(r.leftTd)[0].offsetWidth>45&&(!r.rightTd||t(r.rightTd)[0].offsetWidth-(i-c)>45)&&u.css("left",m+i-c),e.utils.removeSelection(e.curEditor.win)}).bind("mouseup.changeCell",function(l){var f=l.clientX,m=l.clientY,h=0;h=a?m-d+t(r.topTd)[0].offsetHeight>45?m-d:45-t(r.topTd)[0].offsetHeight:f-c+t(r.leftTd)[0].offsetWidth>45&&(!r.rightTd||t(r.rightTd)[0].offsetWidth-(f-c)>45)?f-c:f-c+t(r.leftTd)[0].offsetWidth>45?t(r.rightTd)[0].offsetWidth-45:45-t(r.leftTd)[0].offsetWidth,o(r,h,a),e.utils.removeSelection(e.curEditor.win),t(n).find("td").bind("mousemove.cursorState",function(e){i(e)}),u.remove(),t(n).unbind("mousedown.dragLine"),s.unbind("mousemove.changeCell"),s.unbind("mouseup.changeCell")})}),void 0)}function o(e,n,i){if(i){var r=t(e.topTd).attr("rowspan")?parseInt(t(e.topTd).attr("rowspan")):1,o=parseInt(t(e.topTd).attr("row"))+r,a=[];t(e.topTd).closest("table").find("td:visible,th:visible").each(function(){var e=t(this).attr("rowspan")?parseInt(t(this).attr("rowspan")):1;if(parseInt(t(this).attr("row"))+e===o){var i=parseFloat(t(this).height());a.push({cell:t(this),height:i+n})}});for(var s=a.length,l=0;s>l;l++)a[l].cell.height(a[l].height)}else{var c=t(e.leftTd).attr("colspan")?parseInt(t(e.leftTd).attr("colspan")):1,a=[],d=parseInt(t(e.leftTd).attr("col"))+c;t(e.leftTd).closest("table").find("td:visible,th:visible").each(function(){var e=t(this).attr("colspan")?parseInt(t(this).attr("colspan")):1;if(parseInt(t(this).attr("col"))+e===d){var i=parseFloat(t(this).width()),r=parseFloat(t(this).next("td,th").width());a.push({cell:t(this),width:i+n}),t(this).next("td,th").length&&a.push({cell:t(this).next("td,th"),width:r-n});var o=parseFloat(t(this).closest("table").width())+n>760?760:parseFloat(t(this).closest("table").width())+n;t(this).next("td,th").length||a.push({cell:t(this).closest("table"),width:o})}});for(var s=a.length,l=0;s>l;l++)a[l].cell.width(a[l].width)}}e.listenEditareaExt=function(r){var o=t(r.dom),a=e.config.selectTableClass,s=e.config.selectCellClass;o.delegate("td,th","mousedown",function(i){e.utils.execPlugin("table","freshTableIndex",t(i.target).closest("table"));var r=o.find("body").css("cursor");if("row-resize"===r||"col-resize"===r)return!0;if(1===i.which){var a={col_1:t(i.target).attr("col"),row_1:t(i.target).attr("row")},l=t(i.target).closest("table").find("th,td");l.not(t(i.target)).bind("mousemove.selectCell",function(i){var r=t(i.target),o=r.closest("table");e.utils.removeSelection(e.curEditor.win),l.removeClass(s),a.col_2=r.attr("col"),a.row_2=r.attr("row");var c=Math.max(a.col_1,a.col_2),d=Math.min(a.col_1,a.col_2),u=Math.max(a.row_1,a.row_2),f=Math.min(a.row_1,a.row_2),m=n(o,{colStart:d,colEnd:c,rowStart:f,rowEnd:u});c=m.colEnd,d=m.colStart,u=m.rowEnd,f=m.rowStart;var h=o.find("tr:not(:gt("+u+"),:lt("+f+"))"),p=t();h.each(function(){p=p.add(t(this).find("td,th").not(":gt("+c+"),:lt("+d+")"))}),p.addClass(s),e.utils.removeSelection(e.curEditor.win)}),l.bind("mouseenter",function(){l.removeClass(s),"None"===e.curEditor.win.getSelection().type?l.unbind("mouseenter mousemove.selectCell"):e.utils.setCursor(e.curEditor.win,i.target,!0)}).bind("mouseup",function(){l.unbind("mouseenter")})}}),o.delegate("body","mousedown",function(e){if(1===e.which){var n=t(this);n.find("table").removeClass(a),n.find("td,th").removeClass(s)}}).delegate("body","mouseup",function(){t(this).find("td,th").unbind("mouseenter mousemove.selectCell mouseup")});var l=0;o.delegate("table","mouseenter",function(){clearTimeout(l);var e=t(this),n=e.offset();t(".bke-selecttablebar").data("table",e).css({top:n.top-20,left:n.left-20}).show()}).delegate("table","mouseleave",function(){o.find("body").css("cursor","default"),clearTimeout(l),l=setTimeout(function(){t(".bke-selecttablebar").hide()},200)}),t("#"+r.Eid).delegate(".bke-selecttablebar","click",function(){var e=t(this).data("table");return e.find("td,th").removeClass(s),e.toggleClass(a),!1}).delegate(".bke-selecttablebar","mouseenter",function(){clearTimeout(l)}).delegate(".bke-selecttablebar","mouseleave",function(){clearTimeout(l),l=setTimeout(function(){t(".bke-selecttablebar").hide()},200)}),o.delegate("td","mousemove.cursorState",function(e){i(e)})}}(window.jQuery.jQEditor,window.jQuery),function(e){e.addEvent({name:"readyLog",type:["ready"],fn:function(){return e.log.writeLog("Core is ready","core"),!1}}),e.addEvent({name:"createLog",type:["create"],fn:function(t){return e.log.writeLog("Editor "+t.Eid+" is creating","core"),!1}}),e.addEvent({name:"completeLog",type:["complete"],fn:function(t){return e.log.writeLog("Editor "+t.Eid+" is completed","core"),!1}})}(window.jQuery.jQEditor),function(e,t){var n=t(document);n.bind("click",function(n){var i=t(n.target);i.closest(".bke-btn").size()||e.toolbar.hidePanel()}),n.delegate(".bke-toolbar","mousedown",function(n){var i=t(n.target).closest(".bke-toolbarbox").attr("ref");return e.curId=i,e.curEditor=e.editorList[i],e.curEditor.win.focus(),!1}),n.delegate(".bke-toolbar","click",function(n){var i=t(n.target).closest("[cmd]");if(i.closest(".bke-disabled").length)return!0;if(i.length){var r=i.attr("cmd"),o=i.attr("param"),a=i.attr("args");return e.command(r,o,a),!1}}),n.delegate(".bke-submenu [cmd]","click",function(){e.toolbar.hidePanel()})}(jQuery.jQEditor,jQuery),function(e,t){e.addEvent({name:"elementpath",type:["mouseup"],area:"editArea",fn:function(){for(var n=t("#"+e.curId+" .bke-elementpath"),i=e.utils.getCurElement(),r=[],o=0,a=i.length;a>o;o++)3!==i[o].nodeType&&r.push("<a>"+i[o].nodeName.toLowerCase()+"</a>");n.html("元素路径："+r.join("&gt;"))}})}(jQuery.jQEditor,jQuery),function(e,t){var n=[{name:"宋体",cmd:"fontfamily",param:"SimSun",styleName:"bke-SimSun"},{name:"仿宋体",cmd:"fontfamily",param:"FangSong_GB2312",styleName:"bke-FangSong_GB2312"},{name:"微软雅黑",cmd:"fontfamily",param:"Microsoft YaHei",styleName:"bke-Microsoft_YaHei"},{name:"黑体",cmd:"fontfamily",param:"SimHei",styleName:"bke-SimHei"},{name:"楷体",cmd:"fontfamily",param:"KaiTi_GB2312",styleName:"bke-KaiTi_GB2312"},{name:"Impact",cmd:"fontfamily",param:"Impact",styleName:"bke-Impact"},{name:"Georgia",cmd:"fontfamily",param:"Georgia",styleName:"bke-Georgia"},{name:"Arial",cmd:"fontfamily",param:"Arial",styleName:"bke-Arial"},{name:"Verdana",cmd:"fontfamily",param:"Verdana",styleName:"bke-Verdana"},{name:"Tahoma",cmd:"fontfamily",param:"Tahoma",styleName:"bke-Tahoma"}];e.addPlugin({id:"fontfamilymenu",type:"panel",isEnable:!0,fill:function(t){var i=e.Menu.create(n);e.fillPanel("fontfamilymenu",i,t)},echo:function(e,i){i=i.replace(/'/g,"")||"",i=i.toLowerCase(),t.each(n,function(t,n){return n.param.toLowerCase()===i?(e.find("#icon-fontfamilymenu").find(".bke-Font a").html(n.name),!1):void 0})}})}(jQuery.jQEditor,jQuery),function(e,t){function n(){for(var n={},i={},o={},a=e.utils.getCurElement(),s=a.length,c="",d=0;s>d;d++){var u=a[d].nodeName.toLowerCase();if(i[u]=!0,t(a[d]).attr("style"))for(var f=t(a[d]).attr("style").split(";"),m=f.length,h=0;m>h;h++){var p=f[h].split(":");"string"==typeof p[1]&&(p[0]=p[0].replace(/^[ ]+/g,""),o[p[0]]=p[1].replace(/^[ ]+/g,""))}}for(c in r.customChecked){var g=r.customChecked[c].tag,b=r.customChecked[c].style;n[c]=g&&i[g]===!0?"_on":b&&o[b]===r.customChecked[c].value?"_on":"_off","_off"===n.justifycenter&&"_off"===n.justifyright&&(n.justifyleft="_on")}for(c in r.customValue){var b=r.customValue[c].style;n[c]=b&&o[b]?o[b]:r.customValue[c].state}for(c in r.browserChecked)n[c]=e.curEditor.dom.queryCommandState(c)===!0?"_on":"_off";for(c in r.browserValue)if(e.curEditor.dom.queryCommandValue(c)){if(n[c]=e.curEditor.dom.queryCommandValue(c),"ForeColor"===c||"BackColor"===c){var v=/[0-9]+/g,y=n[c].match(v);n[c]="#";for(var d=0;y.length>d;d++){var E=parseInt(y[d],16);128>E&&(n[c]+="0"),n[c]+=E}}}else n[c]=r.browserValue[c].state;var w=t(e.curEditor.dom).find("table."+e.curEditor.config.selectTableClass).length,C=t(e.curEditor.dom).find("td."+e.curEditor.config.selectCellClass,"th."+e.curEditor.config.selectCellClass).length;for(c in r.tableChecked)if(n[c]="_freeze",0!==w)l.tableSelect[c]!==void 0&&(n[c]=l.tableSelect[c]);else if(0!==C)l.cellSelect[c]!==void 0&&(n[c]=l.cellSelect[c]);else if(i.td===!0||i.th===!0){if(l.cellIn[c]!==void 0&&(n[c]=l.cellIn[c]),"_split"===n[c]){var k=t(e.utils.getCurElement().pop()).closest("td,th");n[c]="_freeze",k.attr("colspan")&&parseInt(k.attr("colspan"))>1&&(n.splittocols="_off",n.splittocells="_off"),k.attr("rowspan")&&parseInt(k.attr("rowspan"))>1&&(n.splittorows="_off",n.splittocells="_off")}"_combine"===n[c]&&(n[c]="_freeze",e.utils.execPlugin("table","combineRowAfter",!0)&&(n.combinerowafter="_off"),e.utils.execPlugin("table","combineColAfter",!0)&&(n.combinecolafter="_off"))}else l.tableOut[c]!==void 0&&(n[c]=l.tableOut[c]);var N=e.curEditor.baseHistory;N&&(n.redo=N.redoState?"_off":"_freeze",n.undo=N.revertState?"_off":"_freeze"),e.curEditor.pasteToText===!0&&(n.pastetotext="_on"),e.pluginList.font&&(n.formatmatch=e.pluginList.font.brushOn[e.curId]?"_on":"_off"),e.curEditor.cursorElements&&t.each(["hn","table","a","sub","sup","pre"],function(i,r){e.curEditor.cursorElements[r]&&t.each(e.curEditor.config.cTagDisable[r],function(e,t){n[t]="_freeze"})});var T=e.curEditor.$toolbar;if(e.curEditor.isShowSource)return T.children(".bke-btn").not("[cmd=codemirror],[cmd=about],[cmd=fullscreen]").addClass("bke-disabled"),void 0;T.children(".bke-btn").not(":has(div.bke-submenu)").removeClass("bke-checked"),T.children(".bke-btn").removeClass("bke-disabled");for(c in n)if("_on"===n[c])T.find("#icon-"+c).closest(".bke-btn").addClass("bke-checked");else if("_freeze"===n[c])T.find("#icon-"+c).closest(".bke-btn").addClass("bke-disabled");else if("_off"===n[c]);else if("backcolor"===c||"forecolor"===c)T.find("#icon-"+c).find("i").css("backgroundColor",n[c]);else if("fontsize"===c||"fontfamily"===c){var x=e.plugin(c+"menu");x&&"function"==typeof x.echo&&x.echo(T,n[c])}}var i=e.config.cCommand,r={browserChecked:{},customChecked:{},browserValue:{},customValue:{},tableChecked:{}};for(var o in i)for(var a in i[o]){var s=i[o][a];""!==s.icon&&(r[s.icon][a]="customChecked"===s.icon||"browserChecked"===s.icon?""===s.param?{tag:s.cmd,state:"_off"}:"pluginCommand"===o?{tag:s.param,state:"_off"}:{style:s.cmd,value:s.param,state:"_off"}:{style:s.cmd,value:s.param,state:"_off"})}var l={tableSelect:{tableprops:"_off",deletetable:"_off"},cellSelect:{cellcolor:"_off",cellcolormenu:"_off",insertcolbefore:"_off",insertcolafter:"_off",insertrowbefore:"_off",insertrowafter:"_off",deletecol:"_off",deleterow:"_off",combinecells:"_off",tableprops:"_off",deletetable:"_off"},cellIn:{cellcolor:"_off",cellcolormenu:"_off",deletecol:"_off",deleterow:"_off",splittocols:"_split",splittorows:"_split",splittocells:"_split",combinecolafter:"_combine",combinerowafter:"_combine",insertcolbefore:"_off",insertcolafter:"_off",insertrowbefore:"_off",insertrowafter:"_off",tableprops:"_off",deletetable:"_off"},tableOut:{inserttable:"_off",inserttablemenu:"_off"}};e.addEvent({name:"iconstate",type:["mouseup","keyup","afterCommand"],area:"editArea",fn:function(){n()}})}(jQuery.jQEditor,jQuery),function(e,t){e.addPlugin({id:"paste",isEnable:!0,click:function(){window.clipboardData?e.curEditor.dom.execCommand("paste"):e.errorMessage("请使用 Ctrl+v 进行粘贴")},cut:function(){e.IE?e.curEditor.dom.execCommand("cut"):e.errorMessage("请使用 Ctrl+x 进行剪切")},copy:function(){e.IE?e.curEditor.dom.execCommand("copy"):e.errorMessage("请使用 Ctrl+c 进行复制")},paste:function(){return e.utils.getBoardContent(e.curEditor,function(n){var i="";i=e.curEditor.isPastetotext?t(n).text():e.utils.filterInner(e.curEditor,n.innerHTML),e.command("insert",i)}),e.IE?!1:void 0},toggleTextpaste:function(){var t=e.curEditor.isPastetotext=!e.curEditor.isPastetotext;this.clicked(t,"pastetotext")}})}(window.jQuery.jQEditor,window.jQuery),function(e){e.addPlugin({id:"redo",isEnable:!0,click:function(){e.curEditor.baseHistory.redo()}})}(window.jQuery.jQEditor),function(e){e.addPlugin({id:"revert",isEnable:!0,click:function(){e.curEditor.baseHistory.revert()}})}(window.jQuery.jQEditor),function(e){e.addPlugin({id:"selectall",title:"清空文档",isEnable:!0,click:function(){e.curEditor.selectAll()}})}(jQuery.jQEditor,jQuery),function(e,t){function n(n,i){var r=document.createElement("div"),o=document.createElement("table");t(o).addClass("bke-plugin-table");for(var a=0;n>a;a++){t(o).append("<tr></tr>");for(var s=0;i>s;s++){var l=t(o).find("tr:eq("+a+")");l.append('<td args="'+(a+1)+"-"+(s+1)+'" cmd="inserttable" param="insert"><a></a></td>')}}return e.Menu.create([{name:"插入表格",cmd:"inserttable",param:"showDialog"}]),t(r).append('<div class="bke-info">0行 0列</div>'),t(r).append(o),r.innerHTML}e.addPlugin({id:"tablemenu",type:"panel",isEnable:!0,fill:function(){e.fillPanel("inserttablemenu",n(10,10)),t(document).delegate(".bke-plugin-table td","mouseenter",function(e){var n=t(e.target).closest("td[args]").attr("args").split("-"),i=parseInt(n[0]),r=parseInt(n[1]),o=t(e.target).closest(".bke-plugin-table");o.parent().children(".bke-info").text(n[0]+"行 "+n[1]+"列"),o.find("td").removeClass("cell-hover"),o.find("tr:lt("+i+")").find("td:lt("+r+")").addClass("cell-hover")}).delegate(".bke-plugin-table","mouseleave",function(e){var n=t(e.target).closest(".bke-plugin-table");n.parent().children(".bke-info").text("0行 0列"),n.find("td").removeClass("cell-hover")})},getTablePanel:function(){return n(10,10)}})}(jQuery.jQEditor,jQuery);